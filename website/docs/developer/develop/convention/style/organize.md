---
sidebar_position: 1
---

# 代码组织

本项目关于代码组织的约定。

## 前提

需先阅读 [前提准备](/docs/developer/develop/intro) 等章节。

## 三原则

1. 函数
   1. 每个函数的行数尽可能控制在 **40** 行以内，参数在 4 个以内，缩进在 **3** 层以内。
   2. 一个模块 (mod) 中超过 50 行的函数勿多于 **1** 个。
   3. 尽可能使用**纯函数**。
2. 类型
   1. 根据实际业务设计尽可能**细粒度**的数据结构，并绑定与其对应的行为。一个类型**不依赖**无关的其他类型。
   2. 不使用字符串表达代码**语义**，而使用类型。
   3. 不使用控制结构实现行为**约束**，而使用类型。
3. 避免复制粘贴。尽可能避免样板代码。

## 安全重构

原则上 trust nothing。

1. 检查所有的字面量 typo。
2. 使用 IDE/编辑器的 Refactor 功能而不是字符串替换来重构。
3. 注意来自进程外部输入的影响。
4. 警惕动态类型和可变的共享状态。
